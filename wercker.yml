box: wercker-labs/docker
build:
  steps:
    - script:
        name: docker version
        code: |
          docker -v

    - script:
        name: build image
        code: |
          docker build -t rodrigosaito/rack_unicorn_docker:$WERCKER_GIT_COMMIT .

    - script:
        name: run tests
        code: |
          docker run rodrigosaito/rack_unicorn_docker:$WERCKER_GIT_COMMIT bundle exec rspec

    - script:
        name: save container
        code: |
          docker run -d --cidfile="/tmp/cid" rodrigosaito/rack_unicorn_docker
          docker export $(cat /tmp/cid) > $WERCKER_OUTPUT_DIR/container.tar

